{% load static %}
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    {% block title %}<title>Malakaviy Imtihon</title>{% endblock %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="{% static 'css/styles.css' %}" rel="stylesheet"/>
    <!--    new datatable-->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
	    
    <!--    new datatable-->



    <style>
	#layoutSidenav.toggled #layoutSidenav_nav {
    	    display: none;
	}
	#layoutSidenav.toggled {
    	    margin-left: -250px;
    	    transition: margin 0.3s ease-in-out;
	}
	@media (max-width: 768px) {
    #layoutSidenav {
        transition: all 0.3s ease-in-out;
    }
    #layoutSidenav.toggled {
        margin-left: 0 !important;
    }
    #layoutSidenav #layoutSidenav_nav {
        position: absolute;
        width: 250px;
        height: 100vh;
        background: #343a40;
        left: -250px;
        transition: left 0.3s ease-in-out;
    }
    #layoutSidenav.toggled #layoutSidenav_nav {
        left: 0;
    }
}
	/* Sidebar Default - Yashirilgan */
#layoutSidenav_nav {
    position: fixed;
    top: 0;
    left: -250px;
    width: 250px;
    height: 100vh;
    background: #343a40;
    transition: left 0.3s ease-in-out;
}

/* Sidebar ochilganda */
#layoutSidenav.toggled #layoutSidenav_nav {
    left: 0;
}


        .card1 {
            width: 340px;
            height: 340px;
            margin: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            background:  #d0ecdc;
        }
        .card2 {
            width: 340px;
            height: 340px;
            margin: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            background:  #d0ecdc;
        }
        .card1-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .card1-content {
            font-size: 3.2rem;
            margin-top: 10px;
        }
        .card2-title {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .card2-content {
            font-size: 5.0rem;
            margin-top: 10px;
        }

        .calendar-container {
    width: 350px;
    margin: 10px;
    padding: 20px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;

}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background: #d0ecdc;
    color: black;
    font-size: 1.2em;
}

.calendar-header button {
    background: none;
    border: none;
    color: black;
    font-size: 1.2em;
    cursor: pointer;
}

.calendar-header button:hover {
    text-decoration: underline;
}

.calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background: #f1f1f1;
    text-align: center;
    font-weight: bold;
    padding: 10px 0;
}

.day-name {
    padding: 5px 0;
}

.calendar-dates {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
}

.calendar-dates div {
    padding: 4px 0;
    margin: 2px;
    border-radius: 4px;
    cursor: pointer;
    background: #f9f9f9;
}

.calendar-dates div:hover {
    background: #95efbc;
    color: white;
}

.calendar-dates .today {
    background: #95efbc;
    color: white;
}
.table-container {
    overflow-x: auto; /* Gorizontal scrollni faqat jadval uchun qo'shish */
    max-width: 100%; /* Jadval kengligini cheklash */
}

table {
    width: 100%; /* Jadval to'liq kenglikda bo'lsin */
    border-collapse: collapse; /* Jadval chegaralarini birlashtirish */
}

th, td {
    text-align: left;
    padding: 8px;
    border: 1px solid #ddd; /* Jadval uchun chegaralar */
}

thead {
    background-color: #f4f4f4; /* Bosh qator uchun rang */
}

    .btn-view {
        padding: 5px 10px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }
    .btn-view:hover {
        background-color: #0056b3;
    }
    .img-circle.profile_img {
    width: 50%;
    background: #fff;
    z-index: 1000;
    position: inherit;
    border: 1px solid rgba(52, 73, 94, 0.44);
    text-align: center;
    }

    .img-circle {
        border-radius: 50%;
    }
    img {
        vertical-align: middle;
        border-style: none;
    }
    .profile_info {
        text-align: center;
        padding: 25px 10px 10px;
        width: 100%;
        float: left;
    }
     .profile_pic{
        text-align: center;
     }
     td{
        border: 1px solid #e6edef;
     }
        .modal-footer button {
            min-width: 100px;
        }
        .form-check-label {
            margin-left: 5px;
        }
        .required {
            color: red;
            font-size: 0.9rem;
        }
          .collapse-content {
        margin-top: 10px;
        background-color: #f9f9f9;
        border-radius: 5px;
        padding: 10px;
    }
         .hidden-content {
            display: none;
        }
.form {
margin-bottom: 0px;
        }
.alert-success {
    color: green;
    background-color: #d4edda;
}

.alert-danger {
    color: red;
    background-color: #f8d7da;
}

.alert-info {
    color: blue;
    background-color: #cce5ff;
}

	.alert-container .alert-success {
    background-color: #28a745; /* Yashil rang */
    color: white;
}

.alert-container .alert-error {
    background-color: #dc3545; /* Qizil rang */
    color: white;
}

    </style>
</head>
<body class="sb-nav-fixed">
<nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
    <!-- Navbar Brand-->
    <h3 class="logo ps-3">
        <img src="https://static.vecteezy.com/system/resources/previews/019/150/626/non_2x/phd-abstract-technology-logo-design-on-white-background-phd-creative-initials-letter-logo-concept-vector.jpg"
             style="max-width: 80px; max-height: 80px"/>PhD Exam</h3>
    <!-- Sidebar Toggle-->
    <button class="btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0" id="sidebarToggle"><i
            class="fas fa-bars"></i></button>
    <!-- Navbar Search-->

    <div class="d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0">

    </div>
    <!-- Navbar-->
    <ul class="navbar-nav ms-auto ms-md-0 me-3 me-lg-4">
        <li class="nav-item dropdown">
            <a class="nav-link" href="{% url 'login' %}" style="color: #24695c"><i class="fas fa-user fa-fw"></i>
		<b>
		Logout
		</b>
                </a>

              </li>
    </ul>
</nav>

<div id="layoutSidenav">
    <div id="layoutSidenav_nav">

        <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
            <!-- menu profile quick info -->
            <div class="profile clearfix">
                <div class="profile_pic">
                    <img src="https://static.vecteezy.com/system/resources/previews/043/900/708/non_2x/user-profile-icon-illustration-vector.jpg"
                         alt="..." class="img-circle profile_img">
                </div>
                <div class="profile_info">
		 <h7 style="font-family:math">{{ request.user.last_name }} {{ request.user.first_name }}  {{ request.user.mid_name }}!</h7>
                    {% if user.is_authenticated %}
                    
                    {% else %}
                    <p>Siz tizimga kirmagansiz. <a href="{% url 'login' %}" style="color: white; font-weight: 500">|
                        LOGIN |</a> sahifasiga o'ting.</p>
                    {% endif %}

                </div>
            </div>
            <!-- /menu profile quick info -->
            <div class="sb-sidenav-menu">
                <div class="nav">
                    <div class="sb-sidenav-menu-heading">MENU</div>
                    	<a class="nav-link" href="{% url 'applications' user.username %}">

                        <div class="sb-nav-link-icon"><i class="fa-solid fas fa-list"></i></div>
                        Arizalar
                        </a>
		        <a class="nav-link" href="{% url 'curriculum_user' %}">
                        <div class="sb-nav-link-icon"><i class="fa-solid fas fa-list"></i></div>
                        Dasturlar
                    </a>
                </div>
            </div>

        </nav>
    </div>
    <div id="layoutSidenav_content">

	{% block content %}

	{% endblock %}

        <footer class="py-4 bg-light mt-auto">
            <div class="container-fluid px-4">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">Malakaviy imtihon &copy; mi.nuu.uz 2025</div>
                </div>
            </div>
        </footer>

    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
<script src="{% static 'js/scripts.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>

<!--new datatable-->
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.1.8/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.1.8/js/dataTables.bootstrap5.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<!--new datatable-->
<script>
    document.getElementById('export-excel').addEventListener('click', function() {
     // AJAX orqali serverga so'rov yuborish
     fetch('/export_excel/', {
         method: 'GET',
     })
     .then(response => response.blob())
     .then(blob => {
         // Excel faylini olish va foydalanuvchiga ko'rsatish
         const link = document.createElement('a');
         link.href = window.URL.createObjectURL(blob);
         link.download = 'applications.xlsx';  // Fayl nomi
         link.click();
     })
     .catch(error => console.error('Error exporting to Excel:', error));
 });

</script>

<script>
    $(document).ready(function() {
    var table = $('#myTable').DataTable({
        "order": [[0, 'desc']] // 0-ustun bo'yicha kamayish tartibida tartiblash
    });
});

</script>

<script>
    // Example starter JavaScript for disabling form submissions if there are invalid fields
(function() {
  'use strict';
  window.addEventListener('load', function() {
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.getElementsByClassName('needs-validation');
    // Loop over them and prevent submission
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

</script>
<script>
    let timeout = 10 * 60 * 1000; // 10 daqiqa
setTimeout(() => {
    alert("Sizning seansingiz tugadi. Iltimos, qayta tizimga kiring.");
    window.location.href = "/login/"; // Login sahifasiga yo'naltirish
}, timeout);

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script>

    document.getElementById('openModalBtn').addEventListener('click', function () {
        const modal = new bootstrap.Modal(document.getElementById('exampleModal'));
        modal.show();
    });
    document.getElementById('openModalBtn1').addEventListener('click', function () {
        const modal = new bootstrap.Modal(document.getElementById('filterModal'));
        modal.show();
    });
    document.getElementById('openModalBtn2').addEventListener('click', function () {
        const modal = new bootstrap.Modal(document.getElementById('crud_modal'));
        modal.show();
    });

    
    document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('openModalBtnd').addEventListener('click', function () {
        var myModal = new bootstrap.Modal(document.getElementById('directionModal'));
        myModal.show();
    });
});


    function toggleCollapse(section) {
        // Collapse elementlarni olish
        const milliyCheckbox = document.querySelector('input[name="chb_milliy"]');
        const boshqaCheckbox = document.querySelector('input[name="chb_boshqa"]');
        const milliyCollapse = document.getElementById('milliy_collapse');
        const boshqaCollapse = document.getElementById('boshqa_collapse');

        // Collapse bo'limlarni boshqarish va checkboxlarni nazorat qilish
        if (section === 'milliy') {
            if (milliyCheckbox.checked) {
                milliyCollapse.style.display = 'block';
                boshqaCollapse.style.display = 'none';
                boshqaCheckbox.checked = false; // Ikkinchi checkboxni o'chirish
            } else {
                milliyCollapse.style.display = 'none';
            }
        } else if (section === 'boshqa') {
            if (boshqaCheckbox.checked) {
                boshqaCollapse.style.display = 'block';
                milliyCollapse.style.display = 'none';
                milliyCheckbox.checked = false; // Birinchi checkboxni o'chirish
            } else {
                boshqaCollapse.style.display = 'none';
            }
        }
    }


</script>
<script>
    // Tugmalarni topamiz
    const buttons = document.querySelectorAll('[data-modal-id]');

    buttons.forEach(button => {
        button.addEventListener('click', function () {
            const modalId = button.getAttribute('data-modal-id');
            const modal = document.getElementById(modalId);
            modal.style.display = 'block';
        });
    });

    // Modalni yopish uchun tugmalar
    const closeButtons = document.querySelectorAll('.modal .btn-close');

    closeButtons.forEach(closeBtn => {
        closeBtn.addEventListener('click', function () {
            const modal = closeBtn.closest('.modal');
            modal.style.display = 'none';
        });
    });

</script>
<script>
    function toggleContent(checkbox, contentId) {
        const contentDiv = document.getElementById(contentId);

        if (checkbox.checked) {
            contentDiv.style.display = "block"; // Forma ochiladi
        } else {
            contentDiv.style.display = "none";  // Forma yopiladi
        }
    }
</script>

<script>

    document.getElementById("submit-btn").onclick = function() {
        this.disabled = true; // Tugmani o'chirish
        this.form.submit(); // Formani yuborish
    };

</script>

<script>
    
function toggleCheckboxes(current, otherId) {
    const otherCheckbox = document.getElementById(otherId);
    if (current.checked) {
        otherCheckbox.checked = false; // Boshqa checkboxni o'chirish
        const reasonContent = document.getElementById('rad_content_' + current.id.split('_')[2]);
        reasonContent.style.display = current.value === 'rejected' ? 'block' : 'none';
    }
}

function updateStatus(applicationId) {
    const form = document.getElementById('statusForm_' + applicationId);
    const formData = new FormData(form);
    const csrfToken = formData.get('csrfmiddlewaretoken');
    const status = formData.get('status');

    if (!status) {
        alert('Iltimos, statusni tanlang!');
        return false;
    }

   fetch(`/update_status/${applicationId}/`, {
    method: 'POST',
    headers: {
        'X-CSRFToken': csrfToken
    },
    body: formData
})
    .then(response => {
        if (!response.ok) {
            console.error("Xatolik:", response.statusText);
            return response.json();  // Agar status 200 bo'lmasa, xatolikni qayta o'qish
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            document.getElementById('status_' + applicationId).innerText =
                data.status === 'accepted' ? 'Qabul qilingan' : 'Rad etilgan';
            const modal = bootstrap.Modal.getInstance(document.getElementById('applicationModal_' + applicationId));
            modal.hide();
        } else {
            alert(data.message || 'Xatolik yuz berdi!');
        }
    })
    .catch(error => {
        console.error('AJAX xatolik:', error);
        alert('Server bilan bog'lanishda xatolik yuz berdi!');
    });

        .catch(error => {
        console.error('AJAX xatolik:', error);
        alert('Server bilan bog'lanishda xatolik yuz berdi!');
    });

</script>
<script>
    def validate_file(file):
    max_size = 5 * 1024 * 1024  # 5MB
    if file.size > max_size:
        raise ValidationError("Fayl hajmi 5MB dan oshmasligi kerak.")
    valid_extensions = ['.pdf', '.doc', '.docx']
    ext = os.path.splitext(file.name)[1]
    if ext.lower() not in valid_extensions:
        raise ValidationError("Faqat PDF yoki Word fayllariga ruxsat beriladi.")

</script>
<script>
    document.getElementById('submit-btn').addEventListener('click', function(event) {
        var directions = document.getElementById('directions').value;
        var sciences = document.getElementById('sciences').value;
        var type_edu = document.getElementById('type_edu').value;
        var first_name = document.getElementById('first_name').value;
        var last_name = document.getElementById('last_name').value;
        var father_name = document.getElementById('father_name').value;
        var phone_number = document.getElementById('phone_number').value;

        // Kerakli maydonlar to'ldirilganligini tekshirish
        if (!directions || !sciences || !type_edu || !first_name || !last_name || !father_name || !phone_number) {
            event.preventDefault();  // Forma yuborilmasligi uchun
            alert("Iltimos, barcha maydonlarni to'ldiring!");
        }
    });
</script>
<script>
    // Sana
  function formatDate(date) {
      const days = ["Yakshanba", "Dushanba", "Seshanba", "Chorshanba", "Payshanba", "Juma", "Shanba"];
      const months = ["Yanvar", "Fevral", "Mart", "Aprel", "May", "Iyun", "Iyul", "Avgust", "Sentabr", "Oktabr", "Noyabr", "Dekabr"];

      const dayName = days[date.getDay()];
      const day = String(date.getDate()).padStart(2, "0");
      const month = String(date.getMonth() + 1).padStart(2, "0");
      const year = date.getFullYear();

      return `${dayName}, ${day}/${month}/${year}`;
  }

  // Sana va soatni yangilash funksiyasi
  function updateDate() {
      const today = new Date();
      const formattedDate = formatDate(today);
      document.getElementById("date-display").textContent = formattedDate;
  }

  // Soat
  function updateTime() {
      const now = new Date();
      const formattedTime = now.toLocaleTimeString("uz-UZ");
      document.getElementById("current-time").textContent = formattedTime;
  }

  // Dastlabki yuklash
  updateDate();
  updateTime();

  // Har 1 soniyada soatni yangilash
  setInterval(updateTime, 1000);


</script>
<script>
    const monthYearElement = document.getElementById("month-year");
const calendarDatesElement = document.getElementById("calendar-dates");
const prevMonthButton = document.getElementById("prev-month");
const nextMonthButton = document.getElementById("next-month");

let currentDate = new Date();

function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDayOfMonth = new Date(year, month, 1).getDay();
    const lastDateOfMonth = new Date(year, month + 1, 0).getDate();

    // Oylik nomi va yilni ko'rsatish
    const monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];
    monthYearElement.textContent = `${monthNames[month]} ${year}`;

    // Sanalarni tozalash
    calendarDatesElement.innerHTML = "";

    // Birinchi kun uchun bo'sh hujayralar
    for (let i = 0; i < (firstDayOfMonth === 0 ? 6 : firstDayOfMonth - 1); i++) {
        const emptyDiv = document.createElement("div");
        calendarDatesElement.appendChild(emptyDiv);
    }

    // Oyning barcha kunlarini qo'shish
    for (let day = 1; day <= lastDateOfMonth; day++) {
        const dayDiv = document.createElement("div");
        dayDiv.textContent = day;

        // Agar bugungi kun bo'lsa, alohida sinf qo'shiladi
        if (
            day === new Date().getDate() &&
            month === new Date().getMonth() &&
            year === new Date().getFullYear()
        ) {
            dayDiv.classList.add("today");
        }

        calendarDatesElement.appendChild(dayDiv);
    }
}

// Oldingi va keyingi oyni boshqarish
prevMonthButton.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar(currentDate);
});

nextMonthButton.addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar(currentDate);
});

// Boshlang'ich kalendarni ko'rsatish
renderCalendar(currentDate);

</script>

<script>
   function updateSciences() {
    var directionId = document.getElementById("direction").value;
    var sciencesSelect = document.getElementById("sciences");

    // Fanlar dropdownini tozalash
    sciencesSelect.innerHTML = '<option value="" disabled selected>Fan nomini tanlang</option>';

    if (directionId) {
        // AJAX so'rovini yuborish
        fetch("{% url 'admin_applications' %}?direction_id=" + directionId, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.sciences.length > 0) {
                // Fanlar mavjud bo'lsa, ularni dropdownga qo'shish
                data.sciences.forEach(science => {
                    var option = document.createElement('option');
                    option.value = science.id;
                    option.textContent = science.name;
                    sciencesSelect.appendChild(option);
                });
            } else {
                // Agar fanlar bo'lmasa, fallback xabarini ko'rsatish
                var option = document.createElement('option');
                option.value = "";
                option.textContent = "Bu ixtisoslikka aloqador fan mavjud emas";
                sciencesSelect.appendChild(option);
            }
        })
        .catch(error => {
            console.error('Fanlarni olishda xato:', error);
        });
    }
}

</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let sidebarToggle = document.getElementById("sidebarToggle");
        let layoutSidenav = document.getElementById("layoutSidenav");

        function toggleSidebar() {
            layoutSidenav.classList.toggle("toggled");
        }

        if (sidebarToggle) {
            sidebarToggle.addEventListener("click", toggleSidebar);
            sidebarToggle.addEventListener("touchstart", toggleSidebar); // Mobil uchun
        }

        // Ekranning tashqarisiga bosganda menyuni yopish
        document.addEventListener("click", function (event) {
            if (!layoutSidenav.contains(event.target) && !sidebarToggle.contains(event.target)) {
                layoutSidenav.classList.remove("toggled");
            }
        });

        document.addEventListener("touchstart", function (event) {
            if (!layoutSidenav.contains(event.target) && !sidebarToggle.contains(event.target)) {
                layoutSidenav.classList.remove("toggled");
            }
        });
    });
</script>


</body>
</html>
